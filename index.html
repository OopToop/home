<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OopToop - Home</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
body { background:#fff; color:#0f0f0f; }
.video-card:hover .video-thumb { border-radius:0; transition:.2s }
.no-scrollbar::-webkit-scrollbar { display:none }
.no-scrollbar { scrollbar-width:none }
</style>
</head>

<body class="font-sans antialiased">

<!-- NAV -->
    <nav class="fixed top-0 left-0 right-0 h-14 bg-white flex items-center justify-between px-4 z-50 border-b border-gray-100">
        <div class="flex items-center gap-4">
            <button class="p-2 hover:bg-gray-100 rounded-full">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
            <a href="index.html" class="flex items-center gap-1 group">
                <div class="flex items-center">
                    <img src="https://raw.githubusercontent.com/OopToop/home/main/logo.png" 
                         alt="OopToop Logo" 
                         class="h-8 w-auto mr-1"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="hidden bg-red-600 rounded-lg p-1 group-hover:bg-red-700 transition-colors">
                        <i data-lucide="play" class="w-5 h-5 text-white fill-current"></i>
                    </div>
                </div>
                <span class="text-xl font-bold tracking-tighter">OopToop</span>
            </a>
        </div>

  <input id="search-input" placeholder="Search" class="hidden md:block border rounded-full px-4 py-1.5 w-full max-w-md bg-gray-50 focus:bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 transition-all">

  <div id="action-section" class="flex gap-3 items-center">
    <!-- Upload Button -->
    <a href="https://docs.google.com/forms/d/e/1FAIpQLScyEZsuGbtWar5SkQlbXofYXDHlHcOgLLJNz-_CyZUBO3hUgg/viewform" 
       target="_blank" 
       class="flex items-center gap-2 bg-gray-100 hover:bg-gray-200 px-4 py-1.5 rounded-full text-sm font-medium transition-colors">
        <i data-lucide="video" class="w-5 h-5"></i>
        <span class="hidden sm:inline">Upload</span>
    </a>
  </div>
</nav>

<!-- CONTENT -->
<main class="pt-16 px-6">

  <!-- TAGS -->
  <div id="tags-bar" class="flex gap-2 mb-6 overflow-x-auto no-scrollbar pb-2">
    <button class="tag-btn bg-black text-white px-3 py-1 rounded whitespace-nowrap" data-tag="All">All</button>
    <button class="tag-btn bg-gray-100 px-3 py-1 rounded whitespace-nowrap" data-tag="Music">Music</button>
    <button class="tag-btn bg-gray-100 px-3 py-1 rounded whitespace-nowrap" data-tag="Gaming">Gaming</button>
    <button class="tag-btn bg-gray-100 px-3 py-1 rounded whitespace-nowrap" data-tag="Tech">Tech</button>
    <button class="tag-btn bg-gray-100 px-3 py-1 rounded" data-tag="reallife">Real Life</button>
    <button class="tag-btn bg-gray-100 px-3 py-1 rounded" data-tag="Animation">Animation</button>
  </div>


  <!-- VIDEO GRID -->
  <div id="video-feed" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>

</main>

<script>
lucide.createIcons();

/* ---------- VIDEOS ---------- */
const feed = document.getElementById('video-feed');
let allVideos = [];

const tagGroups = {
  "Music": ["music", "song", "audio", "musical", "singer", "concert"],
  "Gaming": ["gaming", "games", "gameplay", "play", "walkthrough", "speedrun"],
  "Tech": ["tech", "technology", "hardware", "coding", "programming", "review", "unboxing"]
  "Real Life": ["reallife", "rl", "real life", "life"],
  "Animation": ["animated", "animation", "animations"]
};

fetch('https://api.github.com/repos/OopToop/videos/contents/metadata')
  .then(r=>r.json())
  .then(files=>Promise.all(
    files.filter(f=>f.name.endsWith('.json'))
         .map(f=>fetch(f.download_url).then(r=>r.json()).then(d=>({file:f.name,data:d})))
  ))
  .then(videos=>{
    allVideos = videos;
    render(videos);
  });

function render(list){
  feed.innerHTML='';
  list.forEach(v=>{
    const c=document.createElement('div');
    c.className='video-card cursor-pointer group';
    c.innerHTML=`
      <img class="video-thumb rounded-xl mb-2 w-full aspect-video object-cover" src="https://raw.githubusercontent.com/OopToop/videos/main/thumbnails/${v.data.thumbnail}">
      <h3 class="font-semibold line-clamp-2">${v.data.title}</h3>
      <p class="text-sm text-gray-600 mt-1">${v.data.author || v.data.uploader || 'OopToop Creator'}</p>
    `;
    c.onclick=()=>location.href=`video.html?id=${encodeURIComponent(v.file)}`;
    feed.appendChild(c);
  });
}

// Search input logic
document.getElementById('search-input').oninput=e=>{
  const q=e.target.value.toLowerCase();
  render(allVideos.filter(v=>v.data.title?.toLowerCase().includes(q)));
};

// Genre button logic
document.getElementById('tags-bar').onclick = e => {
  const btn = e.target.closest('.tag-btn');
  if (!btn) return;

  const category = btn.dataset.tag;

  document.querySelectorAll('.tag-btn').forEach(b => {
    b.classList.remove('bg-black', 'text-white');
    b.classList.add('bg-gray-100', 'text-black');
  });
  btn.classList.add('bg-black', 'text-white');
  btn.classList.remove('bg-gray-100', 'text-black');

  if (category === 'All') {
    render(allVideos);
  } else {
    const keywords = tagGroups[category] || [category.toLowerCase()];
    const filtered = allVideos.filter(v => {
      const vTags = ((v.data.tags || "") + " " + (v.data.category || "")).toLowerCase();
      return keywords.some(k => vTags.includes(k));
    });
    render(filtered);
  }
};
</script>

</body>
</html>
