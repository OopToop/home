<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OopToop Video</title>
<style>
body { font-family: Arial; padding: 20px; background: #f5f5f5; }
video { width: 100%; max-width: 640px; border-radius: 6px; }
h1 { margin-bottom: 10px; }
p { margin-bottom: 5px; }
.star { font-size: 24px; cursor: pointer; color: #ccc; }
.star.selected { color: gold; }

/* Topbar styles */
.topbar {
  position: sticky;
  top: 0;
  background: white;
  padding: 12px 20px;
  border-bottom: 1px solid #ddd;
  z-index: 1000;
}

.logo {
  font-size: 22px;
  font-weight: bold;
  text-decoration: none;
  color: black;
}
</style>
</head>
<body>

<!-- Topbar -->
<div class="topbar">
  <a href="index.html" class="logo">OopToop</a>
</div>

<!-- Video content -->
<h1 id="video-title"></h1>
<p id="video-description"></p>
<p id="video-date"></p>
<p>Views: <span id="video-views">0</span></p>

<video id="video-player" controls></video>

<div id="star-rating">
  <span class="star" data-value="1">&#9733;</span>
  <span class="star" data-value="2">&#9733;</span>
  <span class="star" data-value="3">&#9733;</span>
  <span class="star" data-value="4">&#9733;</span>
  <span class="star" data-value="5">&#9733;</span>
</div>

<script>
const owner = 'OopToop';
const repo = 'videos';
const videoBase = `https://raw.githubusercontent.com/${owner}/${repo}/main/videos/`;
const metadataBase = `https://raw.githubusercontent.com/${owner}/${repo}/main/metadata/`;

// Get query parameter ?id=<json file>
function getQueryParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
}

const videoFile = getQueryParam('id');

if(videoFile){
    fetch(metadataBase + videoFile)
        .then(res => res.json())
        .then(data => {
            document.getElementById('video-title').textContent = data.title;
            document.getElementById('video-description').textContent = data.description;
            document.getElementById('video-date').textContent = "Uploaded: " + data.date;

            // views
            const viewsEl = document.getElementById('video-views');
            let viewsKey = `views-${videoFile}`;
            let views = localStorage.getItem(viewsKey) || data.views || 0;
            views++;
            localStorage.setItem(viewsKey, views);
            viewsEl.textContent = views;

            // video src
            const player = document.getElementById('video-player');
            player.src = videoBase + encodeURIComponent(data.filename);

            // star rating
            const stars = document.querySelectorAll('.star');
            let ratingKey = `rating-${videoFile}`;
            let savedRating = localStorage.getItem(ratingKey) || 0;
            stars.forEach(star => {
                if(star.dataset.value <= savedRating) star.classList.add('selected');
                star.addEventListener('click', () => {
                    localStorage.setItem(ratingKey, star.dataset.value);
                    stars.forEach(s => s.classList.remove('selected'));
                    stars.forEach(s => { if(s.dataset.value <= star.dataset.value) s.classList.add('selected') });
                });
            });
        })
        .catch(err => console.error('Error loading video metadata:', err));
} else {
    console.error("No video id provided in query string.");
}
</script>

</body>
</html>
