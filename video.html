<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OopToop - Watch</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Gun.js for Decentralized Auth/Database -->
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
    <style>
        body {
            background-color: #ffffff;
            color: #0f0f0f;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #e5e5e5;
            border-radius: 10px;
        }
        .star {
            cursor: pointer;
            transition: transform 0.1s ease;
        }
        .star:hover {
            transform: scale(1.1);
        }
        .star.selected svg {
            fill: #fbbf24;
            color: #fbbf24;
        }
        video {
            background-color: black;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body class="font-sans antialiased">

    <!-- Top Navigation Bar (Exact copy from Home) -->
    <nav class="fixed top-0 left-0 right-0 h-14 bg-white flex items-center justify-between px-4 z-50 border-b border-gray-100">
        <div class="flex items-center gap-4">
            <button class="p-2 hover:bg-gray-100 rounded-full">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
            <a href="index.html" class="flex items-center gap-1 group">
                <div class="flex items-center">
                    <img src="https://raw.githubusercontent.com/OopToop/home/main/logo.png" 
                         alt="OopToop Logo" 
                         class="h-8 w-auto mr-1"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="hidden bg-red-600 rounded-lg p-1 group-hover:bg-red-700 transition-colors">
                        <i data-lucide="play" class="w-5 h-5 text-white fill-current"></i>
                    </div>
                </div>
                <span class="text-xl font-bold tracking-tighter">OopToop</span>
            </a>
        </div>

        <div class="hidden md:flex items-center flex-1 max-w-[720px] ml-10">
            <div class="flex flex-1 items-center bg-gray-50 border border-gray-300 rounded-l-full px-4 py-1 focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500">
                <i data-lucide="search" class="w-5 h-5 text-gray-400 mr-2"></i>
                <input type="text" id="search-input" placeholder="Search" class="bg-transparent w-full outline-none text-base">
            </div>
            <button class="bg-gray-100 border border-l-0 border-gray-300 rounded-r-full px-5 py-[6px] hover:bg-gray-200">
                <i data-lucide="search" class="w-5 h-5"></i>
            </button>
        </div>

        <div class="flex items-center gap-2 md:gap-4">
            <button class="p-2 hover:bg-gray-100 rounded-full"><i data-lucide="video" class="w-6 h-6"></i></button>
            <button class="p-2 hover:bg-gray-100 rounded-full"><i data-lucide="bell" class="w-6 h-6"></i></button>
            

    <!-- Main Player Layout -->
    <main class="pt-20 px-4 md:px-8 lg:px-16 max-w-[1600px] mx-auto pb-10">
        <div class="flex flex-col lg:flex-row gap-6">
            
            <!-- Left Side: Video Player and Metadata -->
            <div class="flex-1">
                <div class="rounded-xl overflow-hidden aspect-video w-full bg-black">
                    <video id="video-player" class="w-full h-full" controls autoplay></video>
                </div>

                <div class="mt-4">
                    <h1 id="video-title" class="text-xl font-bold line-clamp-2">Loading...</h1>
                    
                    <div class="mt-3 flex flex-wrap items-center justify-between gap-4">
                        <!-- Author Info -->
                        <div class="flex items-center gap-3">
                            <div id="channel-icon" class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center font-bold uppercase">O</div>
                            <div>
                                <p id="uploader-name" class="font-semibold text-base leading-none">OopToop Creator</p>
                                <p class="text-sm text-gray-500 mt-1">1.2M subscribers</p>
                            </div>
                            <button class="ml-4 bg-black text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-800 transition-colors">Subscribe</button>
                        </div>

                        <!-- Actions Bar (Ratings) -->
                        <div class="flex items-center bg-gray-100 rounded-full px-4 py-2 gap-4">
                            <div id="star-rating" class="flex items-center border-r border-gray-300 pr-4">
                                <span class="star p-1" data-value="1"><i data-lucide="star" class="w-5 h-5"></i></span>
                                <span class="star p-1" data-value="2"><i data-lucide="star" class="w-5 h-5"></i></span>
                                <span class="star p-1" data-value="3"><i data-lucide="star" class="w-5 h-5"></i></span>
                                <span class="star p-1" data-value="4"><i data-lucide="star" class="w-5 h-5"></i></span>
                                <span class="star p-1" data-value="5"><i data-lucide="star" class="w-5 h-5"></i></span>
                            </div>
                            <button class="flex items-center gap-2 hover:bg-gray-200 rounded-full transition-colors">
                                <i data-lucide="share-2" class="w-5 h-5"></i>
                                <span class="text-sm font-medium">Share</span>
                            </button>
                        </div>
                    </div>

                    <!-- Description Box -->
                    <div class="mt-4 bg-gray-100 rounded-xl p-3 text-sm hover:bg-gray-200 transition-colors cursor-pointer">
                        <div class="font-bold mb-1">
                            <span id="video-views">0</span> views â€¢ <span id="video-date">Recently</span>
                        </div>
                        <p id="video-description" class="whitespace-pre-wrap text-gray-800"></p>
                    </div>
                </div>
            </div>

            <!-- Right Side: Sidebar/Up Next -->
            <div class="lg:w-[350px] xl:w-[400px]">
                <h2 class="font-bold mb-4">Up next</h2>
                <div id="sidebar-feed" class="flex flex-col gap-4">
                    <p class="text-gray-400 text-sm italic">Loading related videos...</p>
                </div>
            </div>

        </div>
    </main>
<div id="auth-section" class="flex items-center ml-2 gap-2">
    <div id="user-profile" class="hidden w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center text-white text-sm font-medium cursor-pointer"></div>
    <button id="signout-btn" class="hidden flex items-center gap-2 px-3 py-1.5 border border-gray-300 text-red-600 rounded-full text-sm font-medium hover:bg-red-50 transition-colors">Sign out</button>
    <button id="signin-btn" class="flex items-center gap-2 px-3 py-1.5 border border-gray-300 text-blue-600 rounded-full text-sm font-medium hover:bg-blue-50 transition-colors">
        <i data-lucide="user-circle" class="w-5 h-5"></i> Sign in
    </button>
</div>

<script>
lucide.createIcons();

// --- GUN.JS SETUP ---
const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
const user = gun.user().recall({ sessionStorage: true });

const userProfile = document.getElementById('user-profile');
const signinBtn = document.getElementById('signin-btn');
const signoutBtn = document.getElementById('signout-btn');

function updateAuthUI() {
    if (user.is) {
        userProfile.classList.remove('hidden');
        signoutBtn.classList.remove('hidden');
        signinBtn.classList.add('hidden');

        // Display first letter of alias
        if (user.is.alias) {
            userProfile.textContent = user.is.alias.charAt(0).toUpperCase();
        } else {
            user.get('alias').once(name => {
                if (name) userProfile.textContent = name.charAt(0).toUpperCase();
            });
        }
    } else {
        userProfile.classList.add('hidden');
        signoutBtn.classList.add('hidden');
        signinBtn.classList.remove('hidden');
    }
}

// Listen for session recall changes
user.recall({ sessionStorage: true }, ack => updateAuthUI());

// --- LOGIN ---
signinBtn.addEventListener('click', () => {
    const alias = prompt('Username:');
    const pass = prompt('Password:');
    if (!alias || !pass) return;
    user.auth(alias, pass, ack => {
        if (ack.err) alert('Login failed: ' + ack.err);
        else updateAuthUI();
    });
});

// --- SIGN OUT ---
signoutBtn.addEventListener('click', () => {
    user.leave();
    updateAuthUI();
});



    // --- VIDEO LOADING LOGIC ---
    const owner = 'OopToop';
    const repo = 'videos';
    const videoBase = `https://raw.githubusercontent.com/${owner}/${repo}/main/videos/`;
    const metadataBase = `https://raw.githubusercontent.com/${owner}/${repo}/main/metadata/`;

    function getQueryParam(name) {
        const params = new URLSearchParams(window.location.search);
        return params.get(name);
    }

    const videoFile = getQueryParam('id');

    if (videoFile) {
        fetch(metadataBase + videoFile)
            .then(res => res.json())
            .then(data => {
                document.getElementById('video-title').textContent = data.title;
                document.getElementById('video-description').textContent = data.description || "No description.";
                document.getElementById('video-date').textContent = data.date || "Unknown date";
                
                const uploader = data.author || data.uploader || 'OopToop Creator';
                document.getElementById('uploader-name').textContent = uploader;
                document.getElementById('channel-icon').textContent = uploader.charAt(0);

                const viewsEl = document.getElementById('video-views');
                let viewsKey = `views-${videoFile}`;
                let views = localStorage.getItem(viewsKey) || data.views || 0;
                views = parseInt(views) + 1;
                localStorage.setItem(viewsKey, views);
                viewsEl.textContent = views.toLocaleString();

                const player = document.getElementById('video-player');
                player.src = videoBase + encodeURIComponent(data.filename);

                // Stars logic
                const stars = document.querySelectorAll('.star');
                let ratingKey = `rating-${videoFile}`;
                let savedRating = localStorage.getItem(ratingKey) || 0;

                const updateStars = (val) => {
                    stars.forEach(s => {
                        if (parseInt(s.dataset.value) <= val) s.classList.add('selected');
                        else s.classList.remove('selected');
                    });
                };
                updateStars(savedRating);

                stars.forEach(star => {
                    star.addEventListener('click', () => {
                        const val = star.dataset.value;
                        localStorage.setItem(ratingKey, val);
                        updateStars(val);
                    });
                });
            })
            .catch(err => {
                document.getElementById('video-title').textContent = "Error loading video";
            });
    }

    // --- SEARCH REDIRECT ---
    document.getElementById('search-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            window.location.href = `index.html?q=${encodeURIComponent(e.target.value)}`;
        }
    });
</script>

</body>
</html>
