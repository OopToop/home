<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OopToop - Watch</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
video { background:black; }
.star.selected svg { fill:#fbbf24; color:#fbbf24; }
</style>
</head>

<body class="bg-white text-black">

<nav class="fixed top-0 left-0 right-0 h-14 bg-white border-b flex items-center px-4 z-50">
  <a href="index.html" class="font-bold text-xl">OopToop</a>
</nav>

<main class="pt-20 px-4 max-w-[1500px] mx-auto">
<div class="flex flex-col lg:flex-row gap-6">

<!-- MAIN VIDEO -->
<div class="flex-1">
  <video id="video" controls class="w-full aspect-video rounded-xl"></video>

  <h1 id="title" class="text-xl font-bold mt-4"></h1>

  <div class="flex items-center gap-3 mt-3 cursor-pointer" id="channel">
    <img id="pfp" class="w-10 h-10 rounded-full hidden">
    <div id="pfp-fallback" class="w-10 h-10 rounded-full bg-purple-600 text-white flex items-center justify-center font-bold"></div>
    <div>
      <p id="uploader" class="font-semibold"></p>
      <p id="subs" class="text-sm text-gray-500"></p>
    </div>
  </div>

  <div class="mt-4 bg-gray-100 p-3 rounded-xl">
    <p class="font-bold"><span id="views"></span> views â€¢ <span id="date"></span></p>
    <p id="desc" class="mt-2 text-sm"></p>
  </div>
</div>

<!-- UP NEXT -->
<aside class="w-full lg:w-[360px]">
<h2 class="font-bold mb-3">Up next</h2>
<div id="upnext" class="flex flex-col gap-4"></div>
</aside>

</div>
</main>

<script>
lucide.createIcons();

const owner = "OopToop";
const repo = "videos";

const raw = `https://raw.githubusercontent.com/${owner}/${repo}/main`;
const metadataBase = `${raw}/metadata/`;
const videoBase = `${raw}/videos/`;
const thumbBase = `${raw}/thumbnails/`;
const pfpBase = `${raw}/profile%20pictures/`;

const params = new URLSearchParams(location.search);
const id = params.get("id");

if (!id) {
  document.body.innerHTML = "No video ID";
  throw "";
}

(async () => {
  const meta = await fetch(metadataBase + id).then(r => r.json());
  const leaderboard = await fetch(`${raw}/leaderboard.json`).then(r => r.json());
  const files = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/metadata`).then(r => r.json());

  const uploader = meta.uploader;

  /* VIDEO */
  const video = document.getElementById("video");
  video.src = videoBase + encodeURIComponent(meta.filename);
  video.load();

  /* META */
  title.textContent = meta.title;
  desc.textContent = meta.description || "";
  views.textContent = Number(meta.views || 0).toLocaleString();
  date.textContent = meta.date || "Unknown";
  uploader.textContent = uploader;
  subs.textContent = (leaderboard[uploader] || 0).toLocaleString() + " subscribers";

  /* CHANNEL CLICK */
  channel.onclick = () => location.href = `channel.html?c=${encodeURIComponent(uploader)}`;

  /* PFP */
  const pfp = document.getElementById("pfp");
  pfp.src = `${pfpBase}${encodeURIComponent(uploader)}.jpg`;
  pfp.onload = () => {
    pfp.classList.remove("hidden");
    document.getElementById("pfp-fallback").classList.add("hidden");
  };
  pfp.onerror = () => {
    document.getElementById("pfp-fallback").textContent = uploader[0].toUpperCase();
  };

  /* UP NEXT */
  const currentTags = meta.tags || [];
  const upnext = document.getElementById("upnext");

  const others = files
    .filter(f => f.name !== id && f.name.endsWith(".json"))
    .map(f => fetch(f.download_url).then(r => r.json()));

  const vids = await Promise.all(others);

  const scored = vids.map(v => {
    let score = 0;
    if (v.uploader === uploader) score += 20;
    score += (v.tags || []).filter(t => currentTags.includes(t)).length * 10;
    return { v, score };
  }).sort((a,b)=>b.score-a.score).slice(0,8);

  scored.forEach(({v}) => {
    const el = document.createElement("div");
    el.classNa

